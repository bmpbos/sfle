.. _inlinedocs:			http://cran.r-project.org/package=inlinedocs
.. _logging:			http://cran.r-project.org/package=logging
.. _optparse:			http://cran.r-project.org/package=optparse
.. _testthat:			http://cran.r-project.org/package=testthat
.. _package.skeleton:	http://stat.ethz.ch/R-manual/R-patched/library/utils/html/package.skeleton.html
.. _R CMD Rd2pdf:		http://stat.ethz.ch/R-manual/R-patched/library/base/html/RdUtils.html

.. _demo_r SConscript:	../../input/demo_r/SConscript
.. _data.pcl.gz:		../../input/demo_r/input/data.pcl.gz
.. _data2rdata.R:		../../input/demo_r/src/data2rdata.R
.. _rdata2figure.R:		../../input/demo_r/src/rdata2figure.R
.. _data.pdf:			../demo_r/data.pdf
.. _data2rdata.pdf:		../demo_r/data2rdata.pdf
.. _rdata2figure.pdf:	../demo_r/rdata2figure.pdf
.. _data2rdata.txt:		../demo_r/data2rdata.txt
.. _rdata2figure.txt:	../demo_r/rdata2figure.txt
.. _data2rdata:			../tmp/demo_r/data2rdata.R/
.. _rdata2figure:		../tmp/demo_r/rdata2figure.R/

demo_r
------

This example demonstrates how to call `R`_ scripts from within `SflE`_.
For large datasets, it's often useful to use a two-step paradigm in which
one `R`_ script converts data into an ``.RData`` file, and a second script
processes that file into final results.  This allows the processing details
to be changed without incurring the cost of inefficiently rereading the
original dataset.

The demo includes four key aspects of `R`_ in `SflE`_:

* Unit testing using the `testthat`_ library, which parallels `Python`_
	:py:mod:`unittest`.

* Command line argument processing using the `optparse`_ library, which
	parallels `Python`_ :py:mod:`argparse`.

* Logging using the `logging`_ library, which parallels `Python`_
	:py:mod:`logging`.

* Documentation using the `inlinedocs`_ library, which is vaguely
	akin to :py:mod:`pydoc`.

The project consumes and generates the following files:

* Input `data.pcl.gz`_ is a compressed tab-delimited text file of bitmap
	pixel intensity values.

* Output `data.pdf`_ is a PDF plot of the bitmap itself with some simple
	pixel intensity histograms added.

* Output `data2rdata.pdf`_ is the `inlinedocs`_ documentation for the
	`data2rdata.R`_ script, which converts the raw input data into a cached
	``RData`` file.

* Output `rdata2figure.pdf`_ is the `inlinedocs`_ documentation for the
	`rdata2figure.R`_ script, which plots the cached ``RData`` file in a
	configurable manner.

* Outputs `data2rdata.txt`_ and `rdata2figure.txt`_ contain the `testthat`_
	reports for the two `R`_ scripts.

This process generates several intermediate files, the most interesting
of which are the `data2rdata`_ and `rdata2figure`_ "package" directories
created as part of the `inlinedocs`_ process.  These are modified file
directories autogenerated by `R`_'s `package.skeleton`_ function,
from which documentation is subsequently generated by `R CMD Rd2pdf`_.

The `demo_r SConscript`_ file contains further documentation, as do the
`data2rdata.R`_ and `rdata2figure.R`_ scripts and their
`data2rdata.pdf`_ and `rdata2figure.pdf`_ documentation.

Unit testing
~~~~~~~~~~~~

`testthat`_ in `SflE`_ operates through the :py:meth:`sfle.testthat` wrapper,
which in turn leverages the :ref:`testthat.` `R`_ script.  `testthat`_ applies
a directory of unit test scripts to each script being evaluated, typically
named ``test_scriptname`` for a script named ``scriptname.R``.  For the
`data2rdata.R`_ and `rdata2figure.R`_ scripts, this is achieved as follows:

.. literalinclude:: ../../demo_r/SConscript
	:start-after:	StartTestthat
	:end-before:	EndTestthat

For each `R`_ program, a report text file is created in the project's output
directory.  A test directory is registered from the project's source directory,
and `SflE`_ handles dependency assignment, report creation, and error checking.
